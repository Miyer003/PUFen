# 各数据表的独立 JSON Schema

以下是每个数据表的独立 JSON Schema，您可以将它们分别导入到 Apifox 中：

## 1. 用户表(User)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "User",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "主键，使用UUID自动生成，确保全局唯一性"
    },
    "username": {
      "type": "string",
      "maxLength": 50,
      "description": "用户昵称，限制最大长度50字符，用于显示"
    },
    "phone": {
      "type": "string",
      "maxLength": 20,
      "description": "用户手机号，限制长度20字符，唯一索引用于登录"
    },
    "password": {
      "type": "string",
      "description": "加密后的密码，存储使用bcrypt加密后的哈希值"
    },
    "isNewUser": {
      "type": "boolean",
      "default": true,
      "description": "新用户标识，true表示新用户，享受新用户权益"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "记录创建时间，自动设置为记录插入时间"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "记录更新时间，自动在记录变更时更新"
    }
  },
  "required": ["username", "phone", "password"]
}
```

## 2. 积分账户表(PointsAccount)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PointsAccount",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "主键，使用UUID自动生成"
    },
    "userId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的用户ID，与User表一对一关系"
    },
    "balance": {
      "type": "integer",
      "default": 0,
      "description": "当前可用积分余额，默认0"
    },
    "totalEarned": {
      "type": "integer",
      "default": 0,
      "description": "累计获得积分总额，统计用"
    },
    "totalUsed": {
      "type": "integer",
      "default": 0,
      "description": "累计使用积分总额，统计用"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "账户创建时间"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "账户最后更新时间"
    }
  },
  "required": ["userId"]
}
```

## 3. 签到配置表(SignInConfig)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SignInConfig",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "配置ID，主键"
    },
    "weekStartDate": {
      "type": "string",
      "format": "date",
      "description": "本周开始日期（每周一）"
    },
    "basePoints": {
      "type": "integer",
      "default": 10,
      "description": "基础积分值，固定10分"
    },
    "day1Multiplier": {
      "type": "number",
      "default": 1.0,
      "description": "周一积分倍数，默认1.0（10分）"
    },
    "day2Multiplier": {
      "type": "number",
      "description": "周二积分倍数，随机1.0或1.5"
    },
    "day3Multiplier": {
      "type": "number",
      "description": "周三积分倍数，随机1.0或1.5"
    },
    "day4Multiplier": {
      "type": "number",
      "description": "周四积分倍数，随机1.0或1.5"
    },
    "day5Multiplier": {
      "type": "number",
      "description": "周五积分倍数，随机1.0或1.5"
    },
    "day6Multiplier": {
      "type": "number",
      "default": 0.6,
      "description": "周六积分倍数，固定0.6（6分）"
    },
    "day7Multiplier": {
      "type": "number",
      "default": 2.0,
      "description": "周日积分倍数，固定2.0（20分）"
    },
    "bonusDay": {
      "type": "integer",
      "minimum": 3,
      "maximum": 5,
      "description": "连续签到奖励日（3-5中随机一天）"
    },
    "bonusCoupon": {
      "type": "string",
      "description": "连续签到奖励的优惠券类型"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "配置创建时间"
    }
  },
  "required": ["weekStartDate", "bonusDay", "bonusCoupon"]
}
```

## 4. 签到记录表(SignInRecord)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SignInRecord",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "记录ID，主键"
    },
    "userId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的用户ID"
    },
    "configId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的签到配置ID"
    },
    "signInDate": {
      "type": "string",
      "format": "date",
      "description": "签到日期（实际签到或补签的日期）"
    },
    "pointsEarned": {
      "type": "integer",
      "description": "本次签到获得的积分数"
    },
    "isMakeUp": {
      "type": "boolean",
      "default": false,
      "description": "是否为补签记录"
    },
    "makeUpCost": {
      "oneOf": [
        {
          "type": "integer",
          "description": "补签消耗的积分数（5分）"
        },
        {
          "type": "string",
          "const": "order",
          "description": "标记为通过下单补签"
        }
      ],
      "description": "补签消耗的积分数（5分）或标记为'order'表示通过下单补签"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "记录创建时间"
    }
  },
  "required": ["userId", "configId", "signInDate", "pointsEarned"]
}
```

## 5. 组队表(Team)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Team",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "团队ID，主键"
    },
    "captainId": {
      "type": "string",
      "format": "uuid",
      "description": "队长用户ID"
    },
    "name": {
      "type": "string",
      "maxLength": 50,
      "description": "团队名称，最大长度50字符"
    },
    "startTime": {
      "type": "string",
      "format": "date-time",
      "description": "团队创建/开始时间"
    },
    "endTime": {
      "type": "string",
      "format": "date-time",
      "description": "团队结束时间（开始时间+3小时）"
    },
    "totalPoints": {
      "type": "integer",
      "default": 100,
      "description": "团队总积分池，固定100分"
    },
    "status": {
      "type": "string",
      "enum": ["active", "completed", "expired"],
      "default": "active",
      "description": "团队状态"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "记录创建时间"
    }
  },
  "required": ["captainId", "name", "startTime", "endTime"]
}
```

## 6. 团队成员表(TeamMember)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TeamMember",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "记录ID，主键"
    },
    "teamId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的团队ID"
    },
    "userId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的用户ID"
    },
    "role": {
      "type": "string",
      "enum": ["captain", "member"],
      "description": "成员角色：队长或队员"
    },
    "isNewUser": {
      "type": "boolean",
      "description": "加入时是否为新用户"
    },
    "pointsEarned": {
      "type": "integer",
      "description": "该成员获得的积分数"
    },
    "joinedAt": {
      "type": "string",
      "format": "date-time",
      "description": "加入团队的时间"
    }
  },
  "required": ["teamId", "userId", "role", "isNewUser", "pointsEarned", "joinedAt"]
}
```

## 7. 兑换商品表(RewardItem)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RewardItem",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "商品ID，主键"
    },
    "name": {
      "type": "string",
      "maxLength": 100,
      "description": "商品名称，如'满29减4优惠券'"
    },
    "description": {
      "type": "string",
      "description": "商品详细描述"
    },
    "pointsCost": {
      "type": "integer",
      "enum": [5, 10, 15, 20, 25, 30],
      "description": "兑换所需积分（5/10/15/20/25/30）"
    },
    "couponType": {
      "type": "string",
      "description": "优惠券类型，如'满29减4'"
    },
    "couponValue": {
      "type": "number",
      "description": "优惠券实际优惠金额"
    },
    "conditionAmount": {
      "type": "number",
      "description": "满减条件金额（如29元）"
    },
    "stock": {
      "type": "integer",
      "description": "库存数量"
    },
    "stage": {
      "type": "integer",
      "enum": [1, 2],
      "description": "所属阶段（1/2）"
    },
    "isLimited": {
      "type": "boolean",
      "description": "是否限量兑换"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "商品创建时间"
    }
  },
  "required": ["name", "description", "pointsCost", "couponType", "couponValue", "conditionAmount", "stock", "stage", "isLimited"]
}
```

## 8. 兑换记录表(RewardRecord)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RewardRecord",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "记录ID，主键"
    },
    "userId": {
      "type": "string",
      "format": "uuid",
      "description": "兑换用户ID"
    },
    "rewardItemId": {
      "type": "string",
      "format": "uuid",
      "description": "兑换的商品ID"
    },
    "pointsCost": {
      "type": "integer",
      "description": "消耗的积分数"
    },
    "couponCode": {
      "type": "string",
      "description": "生成的优惠券兑换码"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "completed", "cancelled"],
      "default": "pending",
      "description": "兑换状态"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "记录创建时间"
    }
  },
  "required": ["userId", "rewardItemId", "pointsCost", "couponCode"]
}
```

## 9. 积分流水表(PointsTransaction)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PointsTransaction",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "流水ID，主键"
    },
    "userId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的用户ID"
    },
    "accountId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的积分账户ID"
    },
    "amount": {
      "type": "integer",
      "description": "积分变动数量（正数为收入，负数为支出）"
    },
    "type": {
      "type": "string",
      "enum": ["earn", "use", "expire"],
      "description": "积分变动类型"
    },
    "source": {
      "type": "string",
      "enum": ["signin", "team", "reward", "makeup", "order"],
      "description": "积分来源/去向"
    },
    "relatedId": {
      "type": "string",
      "format": "uuid",
      "description": "关联的业务记录ID"
    },
    "description": {
      "type": "string",
      "description": "流水描述，如'周一签到'、'补签消耗'"
    },
    "balanceBefore": {
      "type": "integer",
      "description": "变动前积分余额"
    },
    "balanceAfter": {
      "type": "integer",
      "description": "变动后积分余额"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "流水创建时间"
    }
  },
  "required": ["userId", "accountId", "amount", "type", "source", "relatedId", "description", "balanceBefore", "balanceAfter"]
}
```